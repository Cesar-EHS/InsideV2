{% extends 'base.html' %} 
{% block content %}

<div id="course-view-container" class="bg-white rounded-2xl p-4 sm:p-6 md:p-8 shadow-xl w-full max-w-4xl h-[85vh] mx-auto">
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-800">{{ curso.nombre }}</h1>
    <p class="text-gray-500 mt-1">Selecciona una sección para ver sus actividades.</p>
  </div>

  <div class="space-y-4">
    {% for seccion in curso.secciones %}
    <div class="seccion-acordeon border border-gray-200 rounded-lg overflow-hidden">
      <button class="w-full flex justify-between items-center p-5 text-left bg-gray-50 hover:bg-gray-100 transition duration-300 focus:outline-none">
        <div class="flex items-center space-x-4">
          <div class="flex-shrink-0 flex items-center justify-center h-10 w-10 rounded-full bg-yellow-500 text-white font-bold text-lg">
            {{ loop.index }}
          </div>
          <div>
            <p class="text-lg font-semibold text-gray-800">{{ seccion.nombre }}</p>
            <p class="text-sm text-gray-500">{{ seccion.actividades|length }} Actividades</p>
          </div>
        </div>
        <span class="material-icons text-gray-500 transform transition-transform duration-300">expand_more</span>
      </button>

      <div class="contenido-seccion" style="max-height: 0; overflow: hidden; transition: max-height 0.4s ease-in-out;">
        <ul class="space-y-2 p-5 border-t border-gray-200">
          {% for actividad in seccion.actividades %}
            {% if actividad.tipo_actividad == 'documento' %}
              <li class="flex items-center p-3 -mx-3 rounded-lg text-gray-700 font-medium cursor-pointer transition-colors duration-200 hover:bg-yellow-50 hover:text-yellow-800"
                  data-tipo-actividad="documento" 
                  data-contenido="{{ actividad.documentos[0].ruta_documento if actividad.documentos else '' }}">
                  <span class="material-icons text-yellow-600 mr-4">attach_file</span>
                  <span class="flex-1">{{ actividad.titulo }}</span>
                  <span class="text-sm font-bold text-yellow-600">Previsualizar</span>
              </li>
            {% elif actividad.tipo_actividad == 'video' %}
              <li>
                <a href="{{ url_for('cursos.realizar_actividad', actividad_id=actividad.id) }}" 
                  class="flex items-center p-3 -mx-3 rounded-lg text-gray-700 font-medium transition-colors duration-200 hover:bg-blue-50 hover:text-blue-800">
                    <span class="material-icons text-blue-500 mr-4">videocam</span>
                    <span class="flex-1">{{ actividad.titulo }}</span>
                    <span class="text-sm font-bold text-blue-600">Iniciar Video</span>
                </a>
              </li>
            {% endif %}
          {% else %}
            <li class="text-center text-gray-400">No hay actividades en esta sección.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<div id="preview-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-xl shadow-2xl w-11/12 h-5/6 max-w-5xl flex flex-col">
    <div class="flex justify-between items-center p-4 border-b">
      <h3 id="preview-title" class="text-xl font-semibold text-gray-800">Previsualización</h3>
      <button id="close-preview-modal" class="text-gray-500 hover:text-red-600 text-3xl font-bold">&times;</button>
    </div>
    <div class="flex-1 relative bg-gray-200">
      <div id="viewerContainer" class="absolute inset-0 overflow-auto">
        <div id="viewer" class="pdfViewer"></div>
      </div>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='lib/pdfjs/build/pdf.mjs') }}" type="module"></script>
<script src="{{ url_for('static', filename='lib/pdfjs/web/viewer.mjs') }}" type="module"></script>
<script src="{{ url_for('static', filename='js/abrir_archivo_pdf.js') }}"></script>
<script src="{{ url_for('static', filename='js/abrir_acordeones_secciones.js') }}"></script>
{% endblock %}