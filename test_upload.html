<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Subida de Im√°genes</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; }
        .file-input { margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>Test de Funciones de Subida de Im√°genes</h1>
    
    <div class="test-section">
        <h2>Test 1: Funciones B√°sicas</h2>
        <button onclick="testBasicAlert()">Test Alert B√°sico</button>
        <button onclick="testConsoleLog()">Test Console Log</button>
        <button onclick="testFetchAvailable()">Test Fetch Disponible</button>
    </div>

    <div class="test-section">
        <h2>Test 2: Selecci√≥n de Archivo</h2>
        <input type="file" id="testFileInput" accept="image/*" onchange="testFileSelection()">
        <p>Selecciona un archivo para ver si se detecta correctamente</p>
    </div>

    <div class="test-section">
        <h2>Test 3: Subida Real al Servidor</h2>
        <input type="file" id="realUploadInput" accept="image/*">
        <button onclick="testRealUpload()">Subir Imagen al Servidor</button>
    </div>

    <div class="log" id="logOutput">
        <strong>Log de Pruebas:</strong><br>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('logOutput');
            logDiv.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            console.log(message);
        }

        function testBasicAlert() {
            alert('¬°Alert funciona correctamente!');
            log('‚úÖ Alert b√°sico funcionando');
        }

        function testConsoleLog() {
            console.log('Test de console.log');
            log('‚úÖ Console.log funcionando');
        }

        function testFetchAvailable() {
            if (typeof fetch !== 'undefined') {
                log('‚úÖ Fetch API disponible');
            } else {
                log('‚ùå Fetch API no disponible');
            }
        }

        function testFileSelection() {
            const file = document.getElementById('testFileInput').files[0];
            if (file) {
                log(`‚úÖ Archivo seleccionado: ${file.name} (${file.size} bytes, ${file.type})`);
            } else {
                log('‚ùå No se seleccion√≥ archivo');
            }
        }

        function testRealUpload() {
            const file = document.getElementById('realUploadInput').files[0];
            if (!file) {
                log('‚ùå Selecciona un archivo primero');
                return;
            }

            log(`üîÑ Iniciando subida de: ${file.name}`);

            const formData = new FormData();
            formData.append('login_image', file);

            fetch('/auth/actualizar_configuracion', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                log(`üì° Response status: ${response.status}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                log(`‚úÖ Respuesta del servidor: ${JSON.stringify(data)}`);
            })
            .catch(error => {
                log(`‚ùå Error: ${error.message}`);
            });
        }

        // Test inicial cuando se carga la p√°gina
        window.addEventListener('load', function() {
            log('üöÄ P√°gina cargada completamente');
            testFetchAvailable();
        });
    </script>
</body>
</html>
